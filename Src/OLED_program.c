#include "STD_TYPES.h"
#include "BIT_MATH.h"
#include "TWI_config.h"
#include "TWI_interface.h"
#include "OLED_config.h"
#include "OLED_interface.h"
#include <util/delay.h>


void OLED_VoidSendData(u8 data) {
	// Send start condition
	TWI_SendStartCondition();

	// Send device address with write bit
	TWI_SendSlaveAddressWithWrite(OLED_ADDR);

	// Send data byte
	TWI_MasterWriteDataByte(0x40); // Co = 0, D/C = 1

	// Send data
	TWI_MasterWriteDataByte(data);

	// Send stop condition
	TWI_SendStopCondition();

}


void OLED_VoidSendCommand(u8 command)
{

	TWI_SendStartCondition();
	TWI_SendSlaveAddressWithWrite(OLED_ADDR);
	TWI_MasterWriteDataByte(0x00);
	TWI_MasterWriteDataByte(command);
	TWI_SendStopCondition();


}
void OLED_voidTWIInit(void)
{
	TWI_voidInitMaster(0);
	//_delay_ms(10);
	OLED_VoidInit();
	OLED_VoidClearScreen();

	OLED_VoidSetPosition(0,0);

}

void OLED_VoidInit(void) {

	OLED_VoidSendCommand(0xAE);  //Entire Display OFF /
	OLED_VoidSendCommand(0xD5); // Set Display Clock Divide Ratio and Oscillator Frequency /
	OLED_VoidSendCommand(0x80); // Default Setting for Display Clock Divide Ratio and Oscillator Frequency that is recommended /
	OLED_VoidSendCommand(0xA8); // Set Multiplex Ratio /
	OLED_VoidSendCommand(0x3F); /// 64 COM lines /
	OLED_VoidSendCommand(0xD3);  //Set display offset /
	OLED_VoidSendCommand(0x00); //0 offset /
	OLED_VoidSendCommand(0x40); // Set first line as the start line of the display /
	OLED_VoidSendCommand(0x8D); // Charge pump /
	OLED_VoidSendCommand(0x14); // Enable charge dump during display on /
	OLED_VoidSendCommand(0x20); // Set memory addressing mode /
	OLED_VoidSendCommand(0x00); // Horizontal addressing mode /
	OLED_VoidSendCommand(0xA1); // Set segment remap with column address 127 mapped to segment 0 /
	OLED_VoidSendCommand(0xC8); // Set com output scan direction, scan from com63 to com 0 /
	OLED_VoidSendCommand(0xDA); // Set com pins hardware configuration /
	OLED_VoidSendCommand(0x12); // Alternative com pin configuration, disable com left/right remap /
	OLED_VoidSendCommand(0x81); // Set contrast control /
	OLED_VoidSendCommand(0xfD); // Set Contrast to 128 /
	OLED_VoidSendCommand(0xD9); // Set pre-charge period /
	OLED_VoidSendCommand(0xF1); // Phase 1 period of 15 DCLK, Phase 2 period of 1 DCLK /
	OLED_VoidSendCommand(0xDB); //Set Vcomh deselect level /
	OLED_VoidSendCommand(0x20); // Vcomh deselect level ~ 0.77 Vcc /
	OLED_VoidSendCommand(0xA4); // Entire display ON, resume to RAM content display /
	OLED_VoidSendCommand(0xA6); // Set Display in Normal Mode, 1 = ON, 0 = OFF /
	OLED_VoidSendCommand(0x2E); // Deactivate scroll /
	OLED_VoidSendCommand(0xAF); // Display on in normal mode


}


void OLED_VoidClearScreen(void)
{

	// Clear the display buffer  (col,page)

	OLED_VoidSetPosition(0,0);
	for(u16 i=0; i<6;i++)
	{
		for(u16 j=0;j<1024;j++)
		{

			OLED_VoidSendData(0x00);
			//_delay_ms(1);
		}
	}
}


void OLED_VoidClear_Some_of_Screen(u8 col, u8 page)
{
	OLED_VoidSetPosition(col,page);

	for(u16 j=col;j<127;j++)
	{

		OLED_VoidSendData(0x00);
		//_delay_ms(1);
	}
}




const unsigned char FontLookup_CHARACTERS[56][6]={
		{0x00, 0x00, 0x00, 0x00, 0x00, 0x00}, // Character ' ' (space)
		{0x7E, 0x11, 0x11, 0x11, 0x7E, 0x00}, // Character 'A'
		{0x7F, 0x49, 0x49, 0x49, 0x36, 0x00}, // Character 'B'
		{0x3E, 0x41, 0x41, 0x41, 0x22, 0x00}, // Character 'C'
		{0x7F, 0x41, 0x41, 0x22, 0x1C, 0x00}, // Character 'D'
		{0x7F, 0x49, 0x49, 0x49, 0x41, 0x00}, // Character 'E'
		{0x7F, 0x09, 0x09, 0x09, 0x01, 0x00}, // Character 'F'
		{0x3E, 0x41, 0x49, 0x49, 0x7A, 0x00}, // Character 'G'
		{0x7F, 0x08, 0x08, 0x08, 0x7F, 0x00}, // Character 'H'
		{0x00, 0x41, 0x7F, 0x41, 0x00, 0x00}, // Character 'I'
		{0x20, 0x40, 0x41, 0x3F, 0x01, 0x00}, // Character 'J'
		{0x7F, 0x08, 0x14, 0x22, 0x41, 0x00}, // Character 'K'
		{0x7F, 0x40, 0x40, 0x40, 0x40, 0x00}, // Character 'L'
		{0x7F, 0x02, 0x04, 0x02, 0x7F, 0x00}, // Character 'M'
		{0x7F, 0x04, 0x08, 0x10, 0x7F, 0x00}, // Character 'N'
		{0x3E, 0x41, 0x41, 0x41, 0x3E, 0x00}, // Character 'O'
		{0x7F, 0x09, 0x09, 0x09, 0x06, 0x00}, // Character 'P'
		{0x3E, 0x41, 0x51, 0x21, 0x5E, 0x00}, // Character 'Q'
		{0x7F, 0x09, 0x19, 0x29, 0x46, 0x00}, // Character 'R'
		{0x46, 0x49, 0x49, 0x49, 0x31, 0x00}, // Character 'S'
		{0x01, 0x01, 0x7F, 0x01, 0x01, 0x00}, // Character 'T'
		{0x3F, 0x40, 0x40, 0x40, 0x3F, 0x00}, // Character 'U'
		{0x1F, 0x20, 0x40, 0x20, 0x1F, 0x00}, // Character 'V'
		{0x3F, 0x40, 0x38, 0x40, 0x3F, 0x00}, // Character 'W'
		{0x63, 0x14, 0x08, 0x14, 0x63, 0x00}, // Character 'X'
		{0x07, 0x08, 0x70, 0x08, 0x07, 0x00}, // Character 'Y'
		{0x61, 0x51, 0x49, 0x45, 0x43, 0x00}, // Character 'Z'
		{0x20, 0x54, 0x54, 0x54, 0x78, 0x00}, // Character 'a'
		{0x7F, 0x48, 0x44, 0x44, 0x38, 0x00}, // Character 'b'
		{0x38, 0x44, 0x44, 0x44, 0x20, 0x00}, // Character 'c'
		{0x38, 0x44, 0x44, 0x48, 0x7F, 0x00}, // Character 'd'
		{0x38, 0x54, 0x54, 0x54, 0x18, 0x00}, // Character 'e'
		{0x08, 0x7E, 0x09, 0x01, 0x02, 0x00}, // Character 'f'
		{0x0C, 0x52, 0x52, 0x52, 0x3E, 0x00}, // Character 'g'
		{0x7F, 0x08, 0x04, 0x04, 0x78, 0x00}, // Character 'h'
		{0x00, 0x44, 0x7D, 0x40, 0x00, 0x00}, // Character 'i'
		{0x20, 0x40, 0x44, 0x3D, 0x00, 0x00}, // Character 'j'
		{0x7F, 0x10, 0x28, 0x44, 0x00, 0x00}, // Character 'k'
		{0x00, 0x41, 0x7F, 0x40, 0x00, 0x00}, // Character 'l'
		{0x7C, 0x04, 0x18, 0x04, 0x78, 0x00}, // Character 'm'
		{0x7C, 0x08, 0x04, 0x04, 0x78, 0x00}, // Character 'n'
		{0x38, 0x44, 0x44, 0x44, 0x38, 0x00}, // Character 'o'
		{0x7C, 0x14, 0x14, 0x14, 0x08, 0x00}, // Character 'p'
		{0x08, 0x14, 0x14, 0x18, 0x7C, 0x00}, // Character 'q'
		{0x7C, 0x08, 0x04, 0x04, 0x08, 0x00}, // Character 'r'
		{0x48, 0x54, 0x54, 0x54, 0x20, 0x00}, // Character 's'
		{0x04, 0x3F, 0x44, 0x40, 0x20, 0x00}, // Character 't'
		{0x3C, 0x40, 0x40, 0x20, 0x7C, 0x00}, // Character 'u'
		{0x1C, 0x20, 0x40, 0x20, 0x1C, 0x00}, // Character 'v'
		{0x3C, 0x40, 0x30, 0x40, 0x3C, 0x00}, // Character 'w'
		{0x44, 0x28, 0x10, 0x28, 0x44, 0x00}, // Character 'x'
		{0x0C, 0x50, 0x50, 0x50, 0x3C, 0x00}, // Character 'y'
		{0x44, 0x64, 0x54, 0x4C, 0x44, 0x00}, // Character 'z'
		{0x00, 0x36, 0x36, 0x00, 0x00, 0x00}, // Character ':'
		{0x14, 0x08, 0x3E, 0x08, 0x14, 0x00}, // Character '*'
		{0x00, 0x50, 0x30, 0x00, 0x00, 0x00}, // Character ','

};



void OLED_VoidWriteChar(u8 character) {


	for (u8 i = 0; i <6; i++)
	{
		OLED_VoidSendData(FontLookup_CHARACTERS[character][i]);
	}
}


// (col,page)

void OLED_VoidSetPosition(u8 x, u8 y)
{


	TWI_SendStartCondition();
	TWI_SendSlaveAddressWithWrite(OLED_ADDR);
	TWI_MasterWriteDataByte(0x00);


	TWI_MasterWriteDataByte(0x21);//set colomn address
	TWI_MasterWriteDataByte(x);
	TWI_MasterWriteDataByte(0x7F);


	TWI_MasterWriteDataByte(0x22);//set page address
	TWI_MasterWriteDataByte(y);
	TWI_MasterWriteDataByte(0x07);

	TWI_SendStopCondition();

	/*
	OLED_VoidSendCommand(0x20);//set memory addressing mode
	OLED_VoidSendCommand(0x02);//Horizontal addressing mode

	OLED_VoidSendCommand(0x21);//set colomn address
	OLED_VoidSendCommand(x);
	OLED_VoidSendCommand(0x7F);


	OLED_VoidSendCommand(0x22);
	OLED_VoidSendCommand(y);
	OLED_VoidSendCommand(0x07);
	 */




}





const unsigned char FontLookup_NUMBERS[42][6] = {
		{0x00, 0x00, 0x5F, 0x00, 0x00, 0x00}, // Character '!'
		{0x00, 0x07, 0x00, 0x07, 0x00, 0x00}, // Character '"'
		{0x14, 0x7F, 0x14, 0x7F, 0x14, 0x00}, // Character '#'
		{0x24, 0x2A, 0x7F, 0x2A, 0x12, 0x00}, // Character '$'
		{0x23, 0x13, 0x08, 0x64, 0x62, 0x00}, // Character '%'
		{0x36, 0x49, 0x55, 0x22, 0x50, 0x00}, // Character '&'
		{0x00, 0x05, 0x03, 0x00, 0x00, 0x00}, // Character '''
		{0x00, 0x1C, 0x22, 0x41, 0x00, 0x00}, // Character '('
		{0x00, 0x41, 0x22, 0x1C, 0x00, 0x00}, // Character ')'
		{0x14, 0x08, 0x3E, 0x08, 0x14, 0x00}, // Character '*'
		{0x08, 0x08, 0x3E, 0x08, 0x08, 0x00}, // Character '+'
		{0x00, 0x50, 0x30, 0x00, 0x00, 0x00}, // Character ','
		{0x08, 0x08, 0x08, 0x08, 0x08, 0x00}, // Character '-'
		{0x00, 0x60, 0x60, 0x00, 0x00, 0x00}, // Character '.'
		{0x20, 0x10, 0x08, 0x04, 0x02, 0x00}, // Character '/'
		{0x3E, 0x51, 0x49, 0x45, 0x3E, 0x00}, // Character '0'
		{0x00, 0x42, 0x7F, 0x40, 0x00, 0x00}, // Character '1'
		{0x42, 0x61, 0x51, 0x49, 0x46, 0x00}, // Character '2'
		{0x21, 0x41, 0x45, 0x4B, 0x31, 0x00}, // Character '3'
		{0x18, 0x14, 0x12, 0x7F, 0x10, 0x00}, // Character '4'
		{0x27, 0x45, 0x45, 0x45, 0x39, 0x00}, // Character '5'
		{0x3C, 0x4A, 0x49, 0x49, 0x30, 0x00}, // Character '6'
		{0x01, 0x71, 0x09, 0x05, 0x03, 0x00}, // Character '7'
		{0x36, 0x49, 0x49, 0x49, 0x36, 0x00}, // Character '8'
		{0x06, 0x49, 0x49, 0x29, 0x1E, 0x00}, // Character '9'
		{0x00, 0x36, 0x36, 0x00, 0x00, 0x00}, // Character ':'
		{0x00, 0x56, 0x36, 0x00, 0x00, 0x00}, // Character ';'
		{0x00, 0x08, 0x14, 0x22, 0x41, 0x00}, // Character '<'
		{0x14, 0x14, 0x14, 0x14, 0x14, 0x00}, // Character '='
		{0x00, 0x41, 0x22, 0x14, 0x08, 0x00}, // Character '>'
		{0x02, 0x01, 0x51, 0x09, 0x06, 0x00}, // Character '?'
		{0x32, 0x49, 0x79, 0x41, 0x3E, 0x00}, // Character '@'
		{0x00, 0x7F, 0x41, 0x41, 0x00, 0x00}, // Character '['
		{0x02, 0x04, 0x08, 0x10, 0x20, 0x00}, // Character '\'
		{0x00, 0x41, 0x41, 0x7F, 0x00, 0x00}, // Character ']'
		{0x04, 0x02, 0x01, 0x02, 0x04, 0x00}, // Character '^'
		{0x40, 0x40, 0x40, 0x40, 0x40, 0x00}, // Character '_'
		{0x00, 0x01, 0x02, 0x04, 0x00, 0x00}, // Character '`'
		{0x00, 0x08, 0x36, 0x41, 0x00, 0x00}, // Character '{'
		{0x00, 0x00, 0x7F, 0x00, 0x00, 0x00}, // Character '|'
		{0x00, 0x41, 0x36, 0x08, 0x00, 0x00}, // Character '}'
		{0x08, 0x08, 0x2A, 0x1C, 0x08, 0x00}, // Character '~'
};










void OLED_write_one_number(u8 number)
{
	for (u8 i = 0; i <6; i++)
	{
		OLED_VoidSendData(FontLookup_NUMBERS[number][i]);
	}
}


void OLED_voidSend_one_character(u8 character)
{
	u8 Local_u8Counter=0;

	if(character==42)
	{
		OLED_VoidWriteChar(54);
		Local_u8Counter++;
	}
	else if(character==44)
	{
		OLED_VoidWriteChar(55);
		Local_u8Counter++;
	}
	else if(character==32)
	{
		OLED_VoidWriteChar(0);
		Local_u8Counter++;
	}
	else if(character>64 && character<91)
	{
		OLED_VoidWriteChar(character-64);
		Local_u8Counter++;
	}
	else if(character>96 && character<123)
	{
		OLED_VoidWriteChar(character-70);
		Local_u8Counter++;
	}
	else
	{

	}

}




void OLED_voidSendString(const char* Copy_pcString)
{
	u8 Local_u8Counter=0;
	while(Copy_pcString[Local_u8Counter]!='\0')
	{
		if(Copy_pcString[Local_u8Counter]==42)
		{
			OLED_VoidWriteChar(54);
			Local_u8Counter++;
		}
		else if(Copy_pcString[Local_u8Counter]==44)
		{
			OLED_VoidWriteChar(55);
			Local_u8Counter++;
		}
		else if(Copy_pcString[Local_u8Counter]==58)
		{
			OLED_VoidWriteChar(53);
			Local_u8Counter++;
		}
		else if(Copy_pcString[Local_u8Counter]==32)
		{
			OLED_VoidWriteChar(0);
			Local_u8Counter++;
		}
		else if(Copy_pcString[Local_u8Counter]>64 && Copy_pcString[Local_u8Counter]<91)
		{
			OLED_VoidWriteChar(Copy_pcString[Local_u8Counter]-64);
			Local_u8Counter++;
		}
		else if(Copy_pcString[Local_u8Counter]>96 && Copy_pcString[Local_u8Counter]<123)
		{
			OLED_VoidWriteChar(Copy_pcString[Local_u8Counter]-70);
			Local_u8Counter++;
		}
		else
		{

		}
	}
}

void OLED_write_number(u32 Copy_u32Number)
{
	u32 Local_u32Number=Copy_u32Number;
	u32 Local_u32Number2=Copy_u32Number;
	u32 Local_u32reminder;
	u8 Local_u32counter =0;
	s8 s ;


	if(Copy_u32Number==0)
	{
		OLED_write_one_number(0);
	}
	else
	{
		while(Local_u32Number2!=0)
		{
			Local_u32Number2=Local_u32Number2/10;
			Local_u32counter++;
		}
		u8 arr[Local_u32counter];

		for (s=0 ; s<Local_u32counter  ;s++)
		{
			Local_u32reminder= Local_u32Number%10 ;
			arr[s]=Local_u32reminder;
			Local_u32Number=Local_u32Number/10;

		}
		for(s=Local_u32counter-1;s>=0;s--)
		{
			arr[s]+=48;

			if(arr[s]>47 && arr[s]<58)
			{
				OLED_write_one_number(arr[s]-33);

			}
			else if(arr[s]>96 && arr[s]<123)
			{
				OLED_VoidWriteChar(arr[s]-70);

			}
			else
			{

			}
		}

	}
}




